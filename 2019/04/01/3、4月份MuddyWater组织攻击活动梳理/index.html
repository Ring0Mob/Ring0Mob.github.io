<!DOCTYPE html>
<html>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="3、4月份MuddyWater组织攻击活动梳理  &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;自3月底，MuddyWater组织开始在诱饵文档中使用远程模板注入执行宏的技术持续攻击巴基斯坦、伊拉克、土耳其和约旦等中东和南亚国家，这些诱饵文档经过精心的社会工程学手段制作，具有很强的针对性和欺骗性。远程模板包含的恶意宏被执行后，将提取和运行隐藏在窗体控件中的主体功能宏，实现权限维持和本地释放编码过">
<meta name="keywords" content="MuddyWater,APT">
<meta property="og:type" content="article">
<meta property="og:title" content="3、4月份MuddyWater组织攻击活动梳理">
<meta property="og:url" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/index.html">
<meta property="og:site_name" content="The Cyber_Hunter">
<meta property="og:description" content="3、4月份MuddyWater组织攻击活动梳理  &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;自3月底，MuddyWater组织开始在诱饵文档中使用远程模板注入执行宏的技术持续攻击巴基斯坦、伊拉克、土耳其和约旦等中东和南亚国家，这些诱饵文档经过精心的社会工程学手段制作，具有很强的针对性和欺骗性。远程模板包含的恶意宏被执行后，将提取和运行隐藏在窗体控件中的主体功能宏，实现权限维持和本地释放编码过">
<meta property="og:image" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/Nayatel.server.docx.png">
<meta property="og:image" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/Important%20Report.docx.png">
<meta property="og:image" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/Invited%20to%20cooperate..docx.png">
<meta property="og:image" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/NETA.png">
<meta property="og:image" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/F35-Specifications.doc.png">
<meta property="og:image" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/EML_Unistudent_SocialID.docx.png">
<meta property="og:image" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/Unistudent_SocialID.docx.png">
<meta property="og:image" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/Next%20Pages.png">
<meta property="og:image" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/template_link.png">
<meta property="og:image" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/template_mainpage.png">
<meta property="og:image" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/AccessVBOM.png">
<meta property="og:image" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/ffmm_UserForm.png">
<meta property="og:image" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/macro_Func_kafp.png">
<meta property="og:image" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/macro_maintains.png">
<meta property="og:image" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/macro_2pics.png">
<meta property="og:image" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/macro_fakeErrorEsg.png">
<meta property="og:image" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/fakeErrorEsg.png">
<meta property="og:image" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/powerstats_config.png">
<meta property="og:image" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/powerstats_sysinfoCollect.png">
<meta property="og:image" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/powerstats_publicIP.png">
<meta property="og:image" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/powerstats_strCat.png">
<meta property="og:image" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/powerstats_C2post.png">
<meta property="og:image" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/powerstats_Command&Ctl.png">
<meta property="og:image" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/group_config.png">
<meta property="og:image" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/twitter_illkikkyou.png">
<meta property="og:image" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/new_powerstats.png">
<meta property="og:updated_time" content="2019-07-02T06:46:25.785Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="3、4月份MuddyWater组织攻击活动梳理">
<meta name="twitter:description" content="3、4月份MuddyWater组织攻击活动梳理  &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;自3月底，MuddyWater组织开始在诱饵文档中使用远程模板注入执行宏的技术持续攻击巴基斯坦、伊拉克、土耳其和约旦等中东和南亚国家，这些诱饵文档经过精心的社会工程学手段制作，具有很强的针对性和欺骗性。远程模板包含的恶意宏被执行后，将提取和运行隐藏在窗体控件中的主体功能宏，实现权限维持和本地释放编码过">
<meta name="twitter:image" content="http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/Nayatel.server.docx.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>3、4月份MuddyWater组织攻击活动梳理</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/projects_url">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" href="/2018/10/29/CVE-2014-635-ppsx-sample/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/&text=3、4月份MuddyWater组织攻击活动梳理"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/&title=3、4月份MuddyWater组织攻击活动梳理"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/&is_video=false&description=3、4月份MuddyWater组织攻击活动梳理"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=3、4月份MuddyWater组织攻击活动梳理&body=Check out this article: http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/&title=3、4月份MuddyWater组织攻击活动梳理"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/&title=3、4月份MuddyWater组织攻击活动梳理"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/&title=3、4月份MuddyWater组织攻击活动梳理"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/&title=3、4月份MuddyWater组织攻击活动梳理"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/&name=3、4月份MuddyWater组织攻击活动梳理&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      
    </div>
  </span>
</div>

    
    <div class="content index my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        3、4月份MuddyWater组织攻击活动梳理
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Kasymobv Lee</span>
      </span>
      
    <div class="postdate">
        <time datetime="2019-04-01T06:15:00.000Z" itemprop="datePublished">2019-04-01</time>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/APT/">APT</a>, <a class="tag-link" href="/tags/MuddyWater/">MuddyWater</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <center>3、4月份MuddyWater组织攻击活动梳理</center>

<p>&nbsp;&nbsp;&nbsp;&nbsp;自3月底，MuddyWater组织开始在诱饵文档中使用远程模板注入执行宏的技术持续攻击巴基斯坦、伊拉克、土耳其和约旦等中东和南亚国家，这些诱饵文档经过精心的社会工程学手段制作，具有很强的针对性和欺骗性。远程模板包含的恶意宏被执行后，将提取和运行隐藏在窗体控件中的主体功能宏，实现权限维持和本地释放编码过的Powershell脚本。该Powershell脚本被运行后，在内存中经过多层解混淆，最终展示出完整的后门功能。通过代码比对，我们最终确认了该Powershell后门为MuddyWater组织的专用木马POWERSTATS。MuddyWater组织为十分活跃的具有地缘政治动机的APT组织，主要针对的目标为中东、南亚和欧美国家，主要攻击意图为窃密和情报刺探。 </p>
<p>1.诱饵文档<br>针对巴基斯坦：样本伪装成来自巴基斯坦国内的著名科技公司“NAYAtel”，诱导受害者启用恶意宏代码：<br><img src="/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/Nayatel.server.docx.png"></p>
<center>图1-1 4月1日攻击文档：Nayatel.server.docx</center><br>&nbsp;&nbsp;&nbsp;&nbsp;针对伊拉克：样本在伊拉克地区活跃，正文中的模糊背景包含了伊拉克国徽“萨拉丁之鹰”，整体上则伪装成政府官方文档：<br><img src="/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/Important Report.docx.png"><br><center>图1-2 4月2日攻击文档样例：Important Report.docx</center><br><img src="/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/Invited to cooperate..docx.png"><br><center>图1-3 4月3日攻击文档：Invited to cooperate..docx</center><br>&nbsp;&nbsp;&nbsp;&nbsp;针对土耳其：样本伪装成某网络安全合作协议，正文中故意穿插看似乱码的符号，欺骗受害者启用宏以调整编码：<br><img src="/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/NETA.png"><br><center>图1-4 3月31日攻击文档：NETAŞ-Tübitak Siber Güvenlik İşbirliği Protokolü V5.doc</center><br><center>（土耳其语 —&gt; NETAŞ-Tübitak网络安全合作协议V5.doc）</center><br><img src="/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/F35-Specifications.doc.png"><br><center>图1-5 4月4日攻击文档：F35-Specifications.doc（F35战斗机规格）</center><br>&nbsp;&nbsp;&nbsp;&nbsp;针对约旦：样本源邮件发件人显示来自约旦官方的“公民身份和护照部门”，正文要求收件人调查核实部分学生的移民信息，附件名“Unistudent_SocialID.docx”，疑似针对约旦境内的教育机构：<br><img src="/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/EML_Unistudent_SocialID.docx.png"><br><img src="/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/Unistudent_SocialID.docx.png"><br><center>图1-6 4月8日攻击文档：Unistudent_SocialID.docx</center>  

<p>2.技术分析  </p>
<center>表2-1针对巴基斯坦攻击文档</center><br><table><br><tr><th>病毒名称</th><th>Trojan[Downloader]/Office.gen</th></tr><br><tr><th>原始文件名</th><th>Nayatel.server.docx</th></tr><br><tr><th>MD5</th><th>592F0D9D7185EADAB0509FDAFDC305AB</th></tr><br><tr><th>文件大小</th><th>41.0 KB (41,999 字节)</th></tr><br><tr><th>文件格式</th><th>Document/Microsoft.DOCX</th></tr><br><tr><th>最后修改时间</th><th>2019:04:01 13:17:00 UTC</th></tr><br><tr><th>模板名</th><th>16433.jpg</th></tr><br><tr><th>创建者</th><th>Windows User</th></tr><br><tr><th>编辑时长</th><th>10 minutes</th></tr><br><tr><th>VT首次上传时间</th><th>2019-04-03 09:39:28 UTC</th></tr><br><tr><th>VT检测结果</th><th>2/ 59</th></tr><br></table><br>&nbsp;&nbsp;&nbsp;&nbsp;诱饵文档正文伪装成来自巴基斯坦境内的著名科技公司“NAYAtel”，正文的下方嵌入了实际上无用的“Next Pages”按钮，欺骗受害者启用宏代码以能够查看“下一页”的内容：<br><img src="/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/Next Pages.png"><br><center>图2-1 针对巴基斯坦攻击文档正文</center><br>&nbsp;&nbsp;&nbsp;&nbsp;从关系文件“\word_rels\settings.xml.rels”中，能看到定义了一个链接到远程模板文档的<relationships>元素：<br><center><a href="http://corplink.com[.]pk/wp-content/themes/buisson/16433.jpg" target="_blank" rel="noopener">http://corplink.com[.]pk/wp-content/themes/buisson/16433.jpg</a></center><br>&nbsp;&nbsp;&nbsp;&nbsp;在诱饵文档打开的过程中便开始向该URL请求恶意的远程模板，当受害者受骗关闭了宏警告时，模板文档附带的恶意宏代码将被运行起来：<br><img src="/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/template_link.png"><br><center>图2-2 诱饵文档链接了一个远程模板</center><br><center>表2-2 恶意远程模板</center><br><table><br><tr><th>病毒名称</th><th>Trojan/Office.VBA.gen</th></tr><br><tr><th>原始文件名</th><th>16433.jpg</th></tr><br><tr><th>MD5</th><th>BB6FDA2CDC852112544D2598A784D04F</th></tr><br><tr><th>文件大小</th><th>119 KB (121,856 字节)</th></tr><br><tr><th>文件格式</th><th>Document/Microsoft.DOC[:Word1997-2003]</th></tr><br><tr><th>最后修改时间</th><th>2019:04:01 07:13:00UTC</th></tr><br><tr><th>模板名</th><th>16433.dot</th></tr><br><tr><th>创建者</th><th>Windows User</th></tr><br><tr><th>代码页</th><th>Latin I</th></tr><br><tr><th>编辑时长</th><th>1 minutes</th></tr><br><tr><th>VT首次上传时间</th><th>2019-04-02 01:49:07 UTC</th></tr><br><tr><th>VT检测结果</th><th>25/ 60</th></tr><br></table><br>&nbsp;&nbsp;&nbsp;&nbsp;模板文档的正文简单地写着“test”：<br><img src="/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/template_mainpage.png"><br><center>图2-3 恶意远程模板正文</center><br>&nbsp;&nbsp;&nbsp;&nbsp;该模板文档带有恶意宏，宏代码被大量混淆，其被允许执行后，首先设置Office安全相关的注册表项，使通过VBA代码操作Excel工作簿时不会显示安全警告，这个操作会被重复两次：<br><center>“HKEY_CURRENT_USER\Software\Microsoft\Office\14.0\Excel\Security”，”AccessVBOM”，1</center><br><img src="/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/AccessVBOM.png"><br><center>图2-4 去混淆后的宏：关闭VBA操作Excel工作簿相关的安全警告</center><br>&nbsp;&nbsp;&nbsp;&nbsp;然后新建一个Excel工作簿（Workbooks），为其添加VBA工程，从窗体“ffmm”的控件“tb1”和“tb2”中读取隐藏的宏代码，写入新建的VBA工程中并运行起来：<br><img src="/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/ffmm_UserForm.png"><br><center>图2-5窗体的空间中隐藏了恶意宏代码</center><br><img src="/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/macro_Func_kafp.png"><br><center>图2-6 去混淆后的宏：读取并运行隐藏在窗体控件中的宏代码</center><br>&nbsp;&nbsp;&nbsp;&nbsp;从控件中读取的宏首先在注册表中创建新的CLSID:{8dac4e38-b146-4617-96a3-a3f839e5c568}：<br><center>“HKEY_CURRENT_USER\Software\Classes\CLSID{8dac4e38-b146-4617-96a3-a3f839e5c568}\Shell\Manage\command\”,”Default”，QTzvhhzaa</center><br>&nbsp;&nbsp;&nbsp;&nbsp;向注册表注册新的开机启动项，实现在系统开启或用户登录时运行一段Powershell命令：<br><center>“HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run”，UpdateService<br>，c:\windows\explorer.exe shell:::{8dac4e38-b146-4617-96a3-a3f839e5c568}</center><br><img src="/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/macro_maintains.png"><br><center>图2-7 宏代码注册新的开机启动项</center><br>&nbsp;&nbsp;&nbsp;&nbsp;将Base64编码并高度混淆的Powershell后门脚本写入“c:\windows\temp\picture.jpg”，将wscript启动脚本写入“c:\windows\temp\icon.ico”：<br><img src="/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/macro_2pics.png"><br><center>图2-8 将Powershell后门和启动脚本写入伪装成图片的文件里</center><br>&nbsp;&nbsp;&nbsp;&nbsp;最后，最初的宏代码将弹出欺骗用户Office版本不兼容的弹窗，该弹窗会重复两次：<br><img src="/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/macro_fakeErrorEsg.png"><br><img src="/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/fakeErrorEsg.png"><br><center>图2-9 弹出欺骗用户Office版本不兼容的弹窗</center>

<p>3.POWERSTATS后门<br>&nbsp;&nbsp;&nbsp;&nbsp;机器开机启动或用户登录时，文件“c:\windows\temp\picture.jpg”中的Powershell后门将被运行，经过多层解混淆，一个功能完整的Powershell后门会在内存中运行。<br>&nbsp;&nbsp;&nbsp;&nbsp;该后门为MuddyWater组织的专用后门，其起始部分是配置信息：加密密钥、C2（<a href="http://gladiyator.tk/None）和加密算法。" target="_blank" rel="noopener">http://gladiyator.tk/None）和加密算法。</a><br><img src="/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/powerstats_config.png"></p>
<p><center>图3-1 POWERSTATS后门的配置信息和加密算法</center><br>&nbsp;&nbsp;&nbsp;&nbsp;通过WMI获取机器网卡IP地址、系统版本及架构、域、计算机名和用户名等：<br><img src="/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/powerstats_sysinfoCollect.png"></p>
<p><center>图3-2采集系统信息</center><br>&nbsp;&nbsp;&nbsp;&nbsp;通过网站“<a href="http://icanhazip[.]com”请求获取公网IP地址：" target="_blank" rel="noopener">http://icanhazip[.]com”请求获取公网IP地址：</a><br><img src="/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/powerstats_publicIP.png"></p>
<p><center>图3-3获取机器公网IP地址</center><br>&nbsp;&nbsp;&nbsp;&nbsp;将采集到的以上系统信息用“**”组合成一条字符串，用加密函数对其加密，再进行GZIP压缩后POST传回C2。之后计算该字符串的哈希值，以此作为上线ID不断向C2通讯，以获取后续指令：<br><img src="/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/powerstats_strCat.png"><br><img src="/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/powerstats_C2post.png"></p>
<p><center>图3-4将采集到的信息加密传回给C2并获取后续指令</center><br>&nbsp;&nbsp;&nbsp;&nbsp;POWERSTATS后门当前支持下载文件、执行CMD命令和执行Powershell命令的功能：<br><img src="/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/powerstats_Command&Ctl.png"></p>
<p><center>图3-5后门支持的指令和功能</center></p>
<p><center>表3-1 后门支持的指令及功能</center></p>
<table><br><tr><th>指令</th><th>功能</th></tr><br><tr><th>upload</th><th>下载文件至本地</th></tr><br><tr><th>cmd</th><th>cmd命令运行回传命令</th></tr><br><tr><th>b64</th><th>base64解码回传数据，调用powershell执行</th></tr><br><tr><th>其他</th><th>直接调用powershell执行回传数据</th></tr><br></table><br><center>表2-4 C2信息</center><br><table><br><tr><th>域名</th><th>IP解析</th><th>地理位置</th></tr><br><tr><th>gladiyator.tk</th><th>192.95.21.28</th><th>加拿大</th></tr><br></table>

<p>4.组织关联与画像<br>&nbsp;&nbsp;在2019年3月至今我们观测到的一系列针对巴基斯坦、土耳其、伊拉克和约旦等国家的网络攻击活动中，诱饵文档最后投递的载荷依然为其专用后门POWERSTATS，本次发现的大部分POWERSTATS后门，同近一个月来国内外多家安全厂商及多次开源情报曝光过的版本，在加密函数和指令功能上几乎没有什么变化，甚至连加密密钥都一致，仅C2被替换掉。这说明该组织几乎不惧怕安全厂商对其进行的曝光，比较符合该组织一贯嚣张的作风：<br><img src="/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/group_config.png"></p>
<p><center>图4-1后门配置信息中的加密密钥完全一致</center><br><img src="/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/twitter_illkikkyou.png"></p>
<p><center>图4-2 2018年国外研究人员在MuddyWater的C2回传中收到了对方的警告</center><br>&nbsp;&nbsp;而在针对土耳其的样例中（2.1小节），我们发现了新版本的POWERSTATS后门，该版本最早在3月20日的开源情报中被提及[1]，360威胁情报中心也对其进行了分析[2]：<br><img src="/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/new_powerstats.png"></p>
<p><center>图4-3 新版本POWERSTATS后门的通讯方式</center><br>&nbsp;&nbsp;当前捕获的诱饵文档，在构造上延续了MuddyWater组织的一贯风格：精心的社会工程学手段，伪装成来自政府官方或本土知名公司，构造模糊的图文背景或无用的交互按钮诱骗受害者启用恶意宏。在这一点上，MuddyWater组织显得独树一帜。 </p>
<p><center>表3-1 Muddywater组织特征画像</center></p>
<table><br><tr><th>组织名称</th><th>Muddywater / TEMP.Zagros</th></tr><br><tr><th>组织性质</th><th>政治动机的APT组织</th></tr><br><tr><th>攻击意图</th><th>情报刺探、间谍活动</th></tr><br><tr><th>针对行业/领域</th><th>政府、军事、电信、石油、教育</th></tr><br><tr><th>针对国家/地区</th><th>沙特阿拉伯、伊拉克、以色列、土耳其、阿联酋、印度、巴基斯坦、格鲁吉亚、美国、阿富汗、阿塞拜疆、约旦等</th></tr><br><tr><th>作业规模</th><th>中小规模</th></tr><br><tr><th>首次曝光</th><th>2017年3月23日，MalwareBytes曝光了一组新的瞄准沙特政府的高针对性鱼叉式邮件攻击活动。同年11月，Palo Alto分析整合了更多的相关活动，将其正式命名为MuddyWater，并指明其与FIN7组织不存在关联。</th></tr><br><tr><th>涉及平台</th><th>Windows</th></tr><br><tr><th>攻击策略</th><th>鱼叉邮件，投递精心制作的社会工程学诱饵文档</th></tr><br><tr><th>攻击技术</th><th>VBA宏、关闭宏警告、高混淆Powershell脚本、wscript调起单线程Powershell代码、PS2EXE</th></tr><br><tr><th>诱饵类型</th><th>.doc、.docx、.docm、.xls</th></tr><br><tr><th>使用漏洞</th><th>无</th></tr><br><tr><th>武器装备</th><th>POWERSTATS后门</th></tr><br></table>

<p>4.小结<br>&nbsp;&nbsp;目前来看，这一系列针对中东和南亚地区国家的持续性网络攻击活动，幕后的攻击组织极有可能为已知的APT组织MuddyWater。自3月起长达一个月的时间里，该组织攻击活动的TTPs没有太大的变化，但是更新了其POWERSTATS后门，预计在更长的时间里，该组织将保持其在中东和南亚等地区的活跃。  </p>
<p>附录一：IoC<br>诱饵文档：<br>592F0D9D7185EADAB0509FDAFDC305AB<br>21AEBECE73549B3C4355A6060DF410E9<br>8A004E93D7EE3B26D94156768BC0839D<br>A066F5B93F4AC85E9ADFE5FF3B10BC28<br>5C6148619ABB10BB3789DCFB32F759A6<br>BB6FDA2CDC852112544D2598A784D04F<br>F12BAB5541A7D8EF4BBCA81F6FC835A3<br>65978DD3D6B3A518F465676AA6BD876E<br>EED599981C097944FA143E7D7F7E17B1<br>0638ADF8FB4095D60FBEF190A759AA9E<br>7680E8AEF62594DC37A7FBB4B45C86B2<br>B9A67FFB81420E68F9E5607CC200604A  </p>
<p>C2：<br>gladiyator.tk<br>94.23.148.194<br>185.162.235.182  </p>
<p>附录二：参考资料<br>[1]    #Suspicious_20190307 aim at Middle East.<br><a href="https://twitter.com/h4ckak/status/1108290593862475776" target="_blank" rel="noopener">https://twitter.com/h4ckak/status/1108290593862475776</a><br>[2]    360TIC：疑似MuddyWater APT组织针对伊拉克移动运营商Korek Telecom的最新攻击活动分析<br><a href="https://ti.360.net/blog/articles/suspected-muddywater-apt-organization-latest-attack-activity-analysis-against-iraqi-mobile-operator-korek-telecom/" target="_blank" rel="noopener">https://ti.360.net/blog/articles/suspected-muddywater-apt-organization-latest-attack-activity-analysis-against-iraqi-mobile-operator-korek-telecom/</a></p>
</relationships>
  </div>
</article>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/projects_url">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/&text=3、4月份MuddyWater组织攻击活动梳理"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/&title=3、4月份MuddyWater组织攻击活动梳理"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/&is_video=false&description=3、4月份MuddyWater组织攻击活动梳理"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=3、4月份MuddyWater组织攻击活动梳理&body=Check out this article: http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/&title=3、4月份MuddyWater组织攻击活动梳理"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/&title=3、4月份MuddyWater组织攻击活动梳理"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/&title=3、4月份MuddyWater组织攻击活动梳理"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/&title=3、4月份MuddyWater组织攻击活动梳理"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2019/04/01/3、4月份MuddyWater组织攻击活动梳理/&name=3、4月份MuddyWater组织攻击活动梳理&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2019 Kasymobv Lee
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/projects_url">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/fontawesome-all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Disqus Comments -->


